# Description:	An MP3 encoder and graphical frame analyzer
# URL:		http://lame.sourceforge.net/
# Maintainer:	sajcho, saux dot aarch64 at gmail dot com
# Depends on:	ncurses nasm

name=lame
version=3.100
release=1
source=(http://downloads.sourceforge.net/project/${name}/${name}/${version}/${name}-${version}.tar.gz \
	id3tagfix.patch \
	lame.pc.in)

build() {
	cd ${name}-${version}

	patch -p1 -i $SRC/id3tagfix.patch

	# fix for parallel builds
	mkdir -p libmp3lame/i386/.libs

	# fix for pic build with new nasm
	sed -i -e '/define sp/s/+/ + /g' libmp3lame/i386/nasm.h

	aclocal && automake --force --add-missing

	./configure \
		--build=$CHOST \
		--host=$CHOST \
		--prefix=/usr \
		--enable-shared \
		--enable-mp3rtp \
		--enable-nasm \
		--disable-gtktest \
		--disable-mp3x \
		--with-pic \
		LIBS="-ltinfo"

	make V=1

	make DESTDIR=$PKG install

	mkdir -p $PKG/usr/lib/pkgconfig/
	sed "s|@PKGVER@|${version}|" $SRC/lame.pc.in \
		> $PKG/usr/lib/pkgconfig/lame.pc

	rm -r $PKG/usr/share/doc
}
